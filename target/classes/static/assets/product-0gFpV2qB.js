var y=Object.defineProperty;var I=(i,o,e)=>o in i?y(i,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[o]=e;var h=(i,o,e)=>I(i,typeof o!="symbol"?o+"":o,e);import{R as S,j as t}from"./index-CBEh9OrQ.js";import{a as u}from"./axios-Bf4ed8-h.js";import{C as L,a as T}from"./CRow-B6iueanq.js";import{C as M,a as v}from"./CCardBody-C_mhQfRI.js";import{C as w}from"./CCardHeader-lWGbaYGZ.js";import{a as m}from"./index.esm-DRP2kedW.js";import{C as A,a as b,b as C,c as l,d as N,e as d}from"./CTable-0SPTFvK0.js";import{P as R}from"./Pagination-C0C04odu.js";import{C as U,a as k,b as F,c as _,d as D}from"./CModalTitle-CFVXDjwN.js";import{C as $}from"./CForm-DfCe1oSE.js";import{C as p}from"./CFormLabel-CH-khIA9.js";import{C as x}from"./CFormInput-DSvChFwj.js";import{C as O}from"./CFormTextarea-Dl9OW20K.js";import{C as J}from"./CFormSelect-CvlTfLpT.js";import"./DefaultLayout-IBbENHfU.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-DU4GGSvz.js";import"./CFormControlValidation-DMTYPj6x.js";const P="http://localhost:8080/api/products";class H{getProducts(){return u.get(`${P}/getall`)}getProductAtPage(o){return u.get(`${P}/getProductPage?page=${o}`)}}const f=new H;class it extends S.Component{constructor(e){super(e);h(this,"handlePageChange",(e,s)=>{this.setState({currentPage:s})});h(this,"toggleModal",(e=null)=>{const s=this.getMaxProductId()+1;this.setState(a=>({showModal:!a.showModal,editProduct:e,newProduct:e||{img:null,id:s,name:"",description:"",categoryId:""}}))});h(this,"handleInputChange",e=>{const{name:s,value:a,files:c}=e.target;if(s==="img"&&c.length>0){const r=new FileReader;r.onloadend=()=>{this.setState(n=>({newProduct:{...n.newProduct,img:r.result}}))},r.readAsDataURL(c[0])}else this.setState(r=>({newProduct:{...r.newProduct,[s]:a}}))});h(this,"getMaxProductId",()=>{const{products:e}=this.state;return e.length===0?0:Math.max(...e.map(s=>s.id))});h(this,"handleSave",()=>{const{newProduct:e,editProduct:s}=this.state,a={id:e.id,name:e.name,description:e.description,img:e.img,status:1,categoryId:e.categoryId};if(e.name===""){alert("Vui lòng nhập tên sản phẩm");return}if(e.description===""){alert("Vui lòng nhập mô tả sản phẩm");return}if(e.categoryId===""){alert("Vui lòng chọn thể loại");return}if(s)alert("Sửa sản phẩm"+JSON.stringify(a)),console.log("Sửa sản phẩm",a),fetch(`http://localhost:8080/api/products/update/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(r=>{console.log("data trả về nè",r),r.ok?(alert("Sửa sản phẩm thành công rồi nè"),this.toggleModal(),this.fetchProducts(this.state.currentPage)):(alert("Có lỗi xảy ra khi sửa sản phẩm ở trong"),console.error("Lỗi sửa sản phẩm:",r))}).catch(r=>{alert("Có lỗi xảy ra khi sửa sản phẩm"),console.error("Lỗi sửa sản phẩm:",r)});else{if(!e.img){alert("Vui lòng chọn hình ảnh");return}alert("Thêm sản phẩm"+JSON.stringify(a)),console.log("Thêm sản phẩm",a),fetch("http://localhost:8080/api/products/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(r=>{console.log("data trả về nè",r),r.ok?(alert("Thêm sản phẩm thành công rồi nè"),this.toggleModal(),this.fetchProducts(this.state.currentPage)):(alert("Có lỗi xảy ra khi thêm sản phẩm ở trong"),console.error("Lỗi thêm sản phẩm:",r))}).catch(r=>{alert("Có lỗi xảy ra khi thêm sản phẩm"),console.error("Lỗi thêm sản phẩm:",r)})}});h(this,"handleDelete",e=>{fetch(`http://localhost:8080/api/products/updateStatus/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:0})}).then(a=>{a.ok?(alert("Xóa sản phẩm thành công rồi nè"),this.fetchProducts(this.state.currentPage)):(alert("Có lỗi xảy ra khi xóa sản phẩm"),console.error("Lỗi xóa sản phẩm:",a))}).catch(a=>{alert("Có lỗi xảy ra khi xóa sản phẩm"),console.error("Lỗi xóa sản phẩm:",a)})});this.state={products:[],categories:[],currentPage:1,pageLimit:0,perPage:5,showModal:!1,editProduct:null,newProduct:{img:null,id:"",name:"",description:"",categoryId:""}}}componentDidMount(){f.getProducts().then(e=>{const{data:s}=e,a=Math.ceil(s.length/this.state.perPage);this.setState({pageLimit:a})}).catch(e=>{console.error("Lỗi fetch products:",e)}),this.fetchProducts(1),this.fetchCategories()}componentDidUpdate(e,s){s.currentPage!==this.state.currentPage&&this.fetchProducts(this.state.currentPage)}fetchProducts(e){f.getProductAtPage(e).then(s=>{const{data:a}=s;this.setState({products:a})}).catch(s=>{console.error("Lỗi fetch products:",s)})}fetchCategories(){fetch(" ").then(s=>s.json()).then(s=>{this.setState({categories:s}),alert("data categories"+JSON.stringify(s)),console.log("data categories"+JSON.stringify(s))}).catch(s=>{console.error("Lỗi fetch categories:",s),alert("Lỗi fetch categories:",s)})}render(){const{products:e,currentPage:s,pageLimit:a,showModal:c,newProduct:r}=this.state;return Array.isArray(e)?t.jsxs(L,{children:[t.jsx(T,{children:t.jsxs(M,{children:[t.jsxs(w,{children:["Product Information",t.jsx(m,{color:"primary",className:"float-end",onClick:()=>this.toggleModal(),children:"Thêm sản phẩm"})]}),t.jsxs(v,{children:[t.jsxs(A,{children:[t.jsx(b,{children:t.jsxs(C,{children:[t.jsx(l,{children:"Hình ảnh"}),t.jsx(l,{children:"ID"}),t.jsx(l,{children:"Tên sản phẩm"}),t.jsx(l,{children:"Mô tả"}),t.jsx(l,{children:"Thể loại"}),t.jsx(l,{children:"Chỉnh sửa"})]})}),t.jsx(N,{children:e.map((n,j)=>t.jsxs(C,{children:[t.jsx(d,{children:t.jsx("img",{src:n.img,alt:"product",className:"product-image"})}),t.jsx(d,{children:n.id||"N/A"}),t.jsx(d,{children:n.name||"N/A"}),t.jsx(d,{children:n.description||"N/A"}),t.jsx(d,{children:this.state.categories.map(g=>g.id===n.categoryId?g.name:null)}),t.jsxs(d,{children:[t.jsx(m,{color:"warning",onClick:()=>this.toggleModal(n),children:"Sửa"}),t.jsx(m,{color:"danger",onClick:()=>this.handleDelete(n.id),children:"Xóa"})]})]},j))})]}),t.jsx(R,{count:a,page:s,onChange:this.handlePageChange,variant:"outlined",shape:"rounded"})]})]})}),t.jsxs(U,{visible:c,onClose:()=>this.toggleModal(),children:[t.jsx(k,{children:t.jsx(F,{children:this.state.editProduct?"Chỉnh sửa sản phẩm":"Thêm sản phẩm"})}),t.jsx(_,{children:t.jsxs($,{children:[t.jsxs("div",{className:"mb-3",children:[t.jsx(p,{htmlFor:"productImage",children:"Hình ảnh"}),t.jsx(x,{type:"file",id:"productImage",name:"img",onChange:this.handleInputChange})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx(p,{htmlFor:"productName",children:"Tên sản phẩm"}),t.jsx(x,{type:"text",id:"productName",name:"name",value:r.name,onChange:this.handleInputChange})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx(p,{htmlFor:"productDescription",children:"Mô tả"}),t.jsx(O,{id:"productDescription",name:"description",rows:3,value:r.description,onChange:this.handleInputChange})]}),t.jsxs("div",{className:"mb-3",children:[t.jsx(p,{htmlFor:"categoryId",children:"Thể loại"}),this.state.categories.length>0&&t.jsxs(J,{id:"categoryId",name:"categoryId",value:r.categoryId,onChange:this.handleInputChange,children:[t.jsx("option",{value:"",children:"Chọn thể loại"}),this.state.categories.map(n=>t.jsx("option",{value:n.id,children:n.name},n.id))]})]})]})}),t.jsx(D,{children:t.jsx(m,{color:"primary",onClick:this.handleSave,children:this.state.editProduct?"Cập nhật":"Lưu"})})]})]}):(console.error("Products is not an array:",e),null)}}export{it as default};
