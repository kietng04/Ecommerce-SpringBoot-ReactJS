var x=Object.defineProperty;var j=(l,r,t)=>r in l?x(l,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[r]=t;var h=(l,r,t)=>j(l,typeof r!="symbol"?r+"":r,t);import{R as f,j as e}from"./index-CBEh9OrQ.js";import{C as y,a as u}from"./CRow-B6iueanq.js";import{C as P,a as T}from"./CCardBody-C_mhQfRI.js";import{C as M}from"./CCardHeader-lWGbaYGZ.js";import{a as n}from"./index.esm-DRP2kedW.js";import{C as L,a as b,b as m,c as d,d as k,e as g}from"./CTable-0SPTFvK0.js";import{P as w}from"./Pagination-C0C04odu.js";import{C as S,a as R,b as I,c as D,d as N}from"./CModalTitle-CFVXDjwN.js";import{C as v}from"./CForm-DfCe1oSE.js";import{C as U}from"./CFormLabel-CH-khIA9.js";import{C as A}from"./CFormInput-DSvChFwj.js";import"./DefaultLayout-IBbENHfU.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-DU4GGSvz.js";import"./CFormControlValidation-DMTYPj6x.js";class Y extends f.Component{constructor(t){super(t);h(this,"handlePageChange",(t,o)=>{this.setState({currentPage:o}),this.fetchCategories(o)});h(this,"toggleModal",(t=null)=>{this.setState(o=>({showModal:!o.showModal,editCategory:t,newCategory:t||{id:"",name:""}}))});h(this,"handleInputChange",t=>{const{name:o,value:a}=t.target;this.setState(s=>({newCategory:{...s.newCategory,[o]:a}}))});h(this,"handleSave",()=>{const{newCategory:t,editCategory:o}=this.state,a={id:t.id,name:t.name};if(t.name===""){alert("Vui lòng nhập tên thể loại");return}const s="http://localhost:8080/api/categories";o?fetch(`${s}/update/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(i=>{i.ok?(alert("Sửa thể loại thành công"),this.toggleModal(),this.fetchCategories(this.state.currentPage)):(alert("Có lỗi xảy ra khi sửa thể loại"),console.error("Lỗi sửa thể loại:",i))}).catch(i=>{alert("Có lỗi xảy ra khi sửa thể loại"),console.error("Lỗi sửa thể loại:",i)}):fetch(`${s}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(i=>{i.ok?(alert("Thêm thể loại thành công"),this.toggleModal(),this.fetchCategories(this.state.currentPage)):(alert("Có lỗi xảy ra khi thêm thể loại"),console.error("Lỗi thêm thể loại:",i))}).catch(i=>{alert("Có lỗi xảy ra khi thêm thể loại"),console.error("Lỗi thêm thể loại:",i)})});h(this,"handleDelete",t=>{fetch(`http://localhost:8080/api/categories/updateStatus/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"}}).then(a=>{a.ok?(alert("Xóa thể loại thành công"),this.fetchCategories(this.state.currentPage)):(alert("Có lỗi xảy ra khi xóa thể loại"),console.error("Lỗi xóa thể loại:",a))}).catch(a=>{alert("Có lỗi xảy ra khi xóa thể loại"),console.error("Lỗi xóa thể loại:",a)})});this.state={categories:[],currentPage:1,pageLimit:0,perPage:5,showModal:!1,editCategory:null,newCategory:{id:"",name:""}}}componentDidMount(){this.fetchCategories(1)}fetchCategories(t){fetch("http://localhost:8080/api/categories/getall").then(a=>a.json()).then(a=>{console.log("Danh sách thể loại:",a),alert("Danh sách thể loại: "+JSON.stringify(a));const s=Math.ceil(a.length/this.state.perPage);this.setState({categories:a,pageLimit:s}),console.log("Danh sach the loai: "+categories)}).catch(a=>{console.error("Lỗi fetch categories:",a)})}render(){const{categories:t,currentPage:o,pageLimit:a,showModal:s,newCategory:i,editCategory:C}=this.state;return e.jsxs(y,{children:[e.jsx(u,{children:e.jsxs(P,{children:[e.jsxs(M,{children:["Category Information",e.jsx(n,{color:"primary",className:"float-end",onClick:()=>this.toggleModal(),children:"Thêm thể loại"})]}),e.jsxs(T,{children:[e.jsxs(L,{children:[e.jsx(b,{children:e.jsxs(m,{children:[e.jsx(d,{children:"ID"}),e.jsx(d,{children:"Tên thể loại"}),e.jsx(d,{children:"Hành động"})]})}),e.jsx(k,{children:t.length===0?alert("Rỗng"):t.map((c,p)=>e.jsxs(m,{children:[e.jsx(g,{children:c.id}),e.jsx(g,{children:c.categoryName}),e.jsxs(g,{children:[e.jsx(n,{color:"warning",onClick:()=>this.toggleModal(c),children:"Sửa"}),e.jsx(n,{color:"danger",onClick:()=>this.handleDelete(c.id),children:"Xóa"})]})]},p))})]}),e.jsx(w,{count:a,page:o,onChange:this.handlePageChange,variant:"outlined",shape:"rounded"})]})]})}),e.jsxs(S,{visible:s,onClose:()=>this.toggleModal(),children:[e.jsx(R,{children:e.jsx(I,{children:C?"Chỉnh sửa thể loại":"Thêm thể loại"})}),e.jsx(D,{children:e.jsx(v,{children:e.jsxs("div",{className:"mb-3",children:[e.jsx(U,{htmlFor:"categoryName",children:"Tên thể loại"}),e.jsx(A,{type:"text",id:"categoryName",name:"name",value:i.name,onChange:this.handleInputChange})]})})}),e.jsxs(N,{children:[e.jsx(n,{color:"secondary",onClick:()=>this.toggleModal(),children:"Đóng"}),e.jsx(n,{color:"primary",onClick:this.handleSave,children:C?"Cập nhật":"Lưu"})]})]})]})}}export{Y as default};
