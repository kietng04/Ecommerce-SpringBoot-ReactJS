var b=Object.defineProperty;var v=(n,a,t)=>a in n?b(n,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[a]=t;var d=(n,a,t)=>v(n,typeof a!="symbol"?a+"":a,t);import{R as N,j as e}from"./index-BH7sOPBo.js";import{C as S,a as w}from"./CRow-CygCprBw.js";import{C as A,a as T}from"./CCardBody-CmThKiQ-.js";import{C as F}from"./CCardHeader-CzXWuWsl.js";import{a as c}from"./index.esm-B-FWGypk.js";import{C as x,a as j,b as p,c as r,d as f,e as i}from"./CTable-DyG5BAIY.js";import{C,a as g,b as D,c as P,d as y}from"./CModalTitle-B7Krt_gO.js";import{C as E}from"./CForm-CxJTSj0V.js";import{C as u}from"./CFormSelect-CCX7zjAp.js";import{C as I}from"./CFormInput-BIdMnn32.js";import"./DefaultLayout-ClZUy6h9.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-CY_B5d_l.js";import"./CFormControlValidation-BJwBFUW5.js";import"./CFormLabel-Ba9FtfNh.js";class Q extends N.Component{constructor(t){super(t);d(this,"fetchProducts",()=>{fetch("http://localhost:8080/api/products/getAllProductWithAllDetails").then(t=>t.json()).then(t=>{this.setState({products:t})}).catch(t=>{console.error("Error fetching products:",t)})});d(this,"fetchEmployees",()=>{fetch("http://localhost:8080/api/employees/current").then(t=>t.json()).then(t=>{console.log("API Response:",t),this.setState({formData:{...this.state.formData,employeeId:t.id,employeeName:t.name}})}).catch(t=>{console.error("Error:",t)})});d(this,"toggleAddModal",()=>{this.setState(t=>({showAddModal:!t.showAddModal,formData:{...t.formData,supplierId:"",importPrice:0,exportPrice:0,selectedProducts:[]}}))});d(this,"toggleViewModal",(t=null)=>{this.setState(l=>({showViewModal:!l.showViewModal,selectedImport:t}))});d(this,"handleAddProduct",()=>{const t=document.querySelector('select[name="product"]').value;if(!t)return;const l=this.state.products.find(o=>o.product.id.toString()===t);l&&this.setState(o=>({formData:{...o.formData,selectedProducts:[...o.formData.selectedProducts,{productId:t,productName:l.product.name,importPrice:this.state.formData.importPrice,exportPrice:this.state.formData.exportPrice}],importPrice:0,exportPrice:0}}))});d(this,"handleFormSubmit",t=>{t.preventDefault();const l={id:null,supplierId:this.state.formData.supplierId,employeeId:this.state.formData.employeeId,importDate:new Date().toISOString(),totalAmount:this.state.formData.selectedProducts.reduce((o,h)=>o+h.importPrice,0),status:""};fetch("http://localhost:8080/api/importproduct/add",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(l)}).then(o=>o.json()).then(o=>{console.log("Import created:",o),this.toggleAddModal()}).catch(o=>{console.error("Error creating import:",o)})});this.state={showAddModal:!1,showViewModal:!1,selectedImport:null,products:[],formData:{supplierId:"",employeeId:"",employeeName:"",importPrice:0,exportPrice:0,selectedProducts:[]}}}componentDidMount(){this.fetchEmployees(),this.fetchProducts()}render(){const{showAddModal:t,showViewModal:l,selectedImport:o,products:h}=this.state,M=[{id:1,importDate:"2024-01-01",supplierId:"SUP001",employeeId:"EMP001",totalAmount:1e6}];return e.jsxs(S,{children:[e.jsx(w,{children:e.jsxs(A,{children:[e.jsxs(F,{children:["Import Product Information",e.jsx(c,{color:"primary",className:"float-end",onClick:this.toggleAddModal,children:"Thêm phiếu nhập"})]}),e.jsx(T,{children:e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs(p,{children:[e.jsx(r,{children:"Mã phiếu nhập"}),e.jsx(r,{children:"Thời gian"}),e.jsx(r,{children:"Mã nhà cung cấp"}),e.jsx(r,{children:"Nhân viên"}),e.jsx(r,{children:"Tổng tiền"}),e.jsx(r,{children:"Hành động"})]})}),e.jsx(f,{children:M.map((s,m)=>e.jsxs(p,{children:[e.jsx(i,{children:s.id}),e.jsx(i,{children:s.importDate}),e.jsx(i,{children:s.supplierId}),e.jsx(i,{children:s.employeeId}),e.jsx(i,{children:s.totalAmount}),e.jsxs(i,{children:[e.jsx(c,{color:"info",onClick:()=>this.toggleViewModal(s),children:"Xem phiếu"}),e.jsx(c,{color:"danger",className:"ms-2",children:"Hủy phiếu"})]})]},m))})]})})]})}),e.jsxs(C,{visible:t,onClose:this.toggleAddModal,size:"lg",children:[e.jsx(g,{children:e.jsx(D,{children:"Thêm phiếu nhập"})}),e.jsx(P,{children:e.jsxs(E,{onSubmit:this.handleFormSubmit,children:[e.jsxs(u,{className:"mb-3",label:"Nhà cung cấp",value:this.state.formData.supplierId,onChange:s=>this.setState({formData:{...this.state.formData,supplierId:s.target.value}}),children:[e.jsx("option",{value:"",children:"Chọn nhà cung cấp"}),e.jsx("option",{value:"1",children:"Nhà cung cấp 1"})]}),e.jsx(u,{className:"mb-3",label:"Nhân viên",value:this.state.formData.employeeId||"",disabled:!0,children:e.jsx("option",{value:this.state.formData.employeeId||"",children:this.state.formData.employeeName||"No Employee Found"})}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-3",children:e.jsxs(u,{name:"product",children:[e.jsx("option",{value:"",children:"Chọn sản phẩm"}),h&&h.map(s=>e.jsx("option",{value:s.product.id,children:`${s.product.name} - Màu: ${s.details[0].color} - Size: ${s.details[0].size}`},s.product.id))]})}),e.jsx("div",{className:"col-3",children:e.jsx(I,{type:"number",label:"Giá nhập",value:this.state.formData.importPrice,onChange:s=>this.setState({formData:{...this.state.formData,importPrice:parseFloat(s.target.value)}})})}),e.jsx("div",{className:"col-3",children:e.jsx(I,{type:"number",label:"Giá xuất",value:this.state.formData.exportPrice,onChange:s=>this.setState({formData:{...this.state.formData,exportPrice:parseFloat(s.target.value)}})})}),e.jsx("div",{className:"col-3 d-flex align-items-end",children:e.jsx(c,{color:"primary",onClick:this.handleAddProduct,children:"Thêm"})})]}),e.jsx("h6",{children:"Danh sách sản phẩm đã chọn"}),e.jsxs(x,{children:[e.jsx(j,{children:e.jsxs(p,{children:[e.jsx(r,{children:"Mã SP"}),e.jsx(r,{children:"Tên SP"}),e.jsx(r,{children:"Giá nhập"}),e.jsx(r,{children:"Giá xuất"})]})}),e.jsx(f,{children:this.state.formData.selectedProducts.map((s,m)=>e.jsxs(p,{children:[e.jsx(i,{children:s.productId}),e.jsx(i,{children:s.productName}),e.jsx(i,{children:s.importPrice}),e.jsx(i,{children:s.exportPrice})]},m))})]}),e.jsxs(y,{children:[e.jsx(c,{color:"secondary",onClick:this.toggleAddModal,children:"Đóng"}),e.jsx(c,{color:"primary",type:"submit",children:"Lưu"})]})]})})]}),e.jsxs(C,{visible:l,onClose:()=>this.toggleViewModal(),children:[e.jsx(g,{children:e.jsx(D,{children:"Chi tiết phiếu nhập"})}),e.jsx(P,{children:o&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Mã phiếu: ",o.id]}),e.jsxs("p",{children:["Thời gian: ",o.importDate]}),e.jsxs("p",{children:["Nhà cung cấp: ",o.supplierId]}),e.jsxs("p",{children:["Nhân viên: ",o.employeeId]}),e.jsxs("p",{children:["Tổng tiền: ",o.totalAmount]})]})}),e.jsx(y,{children:e.jsx(c,{color:"secondary",onClick:()=>this.toggleViewModal(),children:"Đóng"})})]})]})}}export{Q as default};
