var M=Object.defineProperty;var N=(p,d,t)=>d in p?M(p,d,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[d]=t;var c=(p,d,t)=>N(p,typeof d!="symbol"?d+"":d,t);import{R as S,j as e}from"./index-BYDUmWHQ.js";import{C as v,a as w}from"./CRow-BFNj00sZ.js";import{C as T,a as A}from"./CCardBody-ss9n7PLd.js";import{C as q}from"./CCardHeader-CCUAv6yv.js";import{a as h}from"./index.esm-XWd-aNZ_.js";import{C as f,a as g,b as m,c as a,d as C,e as i}from"./CTable-DQZ9k0Ga.js";import{C as y,a as D,b as P,c as I,d as b}from"./CModalTitle-y2EgNCjR.js";import{C as F}from"./CForm-DGHX0QGP.js";import{C as x}from"./CFormSelect-a4MY2675.js";import{C as j}from"./CFormInput-CkUfXBBi.js";import"./DefaultLayout-BohnMtR1.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-CI6zFYIG.js";import"./CFormControlValidation-C1xBt7Zv.js";import"./CFormLabel-CWMvTmHP.js";class Q extends S.Component{constructor(t){super(t);c(this,"fetchProducts",()=>{fetch("http://localhost:8080/api/products/getAllProductWithAllDetails").then(t=>t.json()).then(t=>{this.setState({products:t})}).catch(t=>{console.error("Error fetching products:",t)})});c(this,"fetchEmployees",()=>{fetch("http://localhost:8080/api/employees/current").then(t=>t.json()).then(t=>{this.setState({formData:{...this.state.formData,employeeId:t.id,employeeName:t.name}})}).catch(t=>{console.error("Error:",t)})});c(this,"toggleAddModal",()=>{this.setState(t=>({showAddModal:!t.showAddModal,formData:{...t.formData,supplierId:"",importPrice:0,exportPrice:0,quantity:1,selectedProducts:[]}}))});c(this,"toggleViewModal",(t=null)=>{this.setState(n=>({showViewModal:!n.showViewModal,selectedImport:t}))});c(this,"handleAddProduct",()=>{const t=document.querySelector('select[name="product"]').value;if(!t)return;const n=this.state.products.find(r=>r.product.id.toString()===t);n&&this.setState(r=>({formData:{...r.formData,selectedProducts:[...r.formData.selectedProducts,{productId:t,productName:n.product.name,importPrice:r.formData.importPrice,exportPrice:r.formData.exportPrice,quantity:r.formData.quantity}],importPrice:0,exportPrice:0,quantity:1}}))});c(this,"handleFormSubmit",t=>{t.preventDefault();const n={id:null,supplierId:parseInt(this.state.formData.supplierId)||null,employeeId:this.state.formData.employeeId,importDate:new Date().toISOString(),totalAmount:this.state.formData.selectedProducts.reduce((o,l)=>o+l.importPrice*(l.quantity||1),0),status:""},r=this.state.formData.selectedProducts.map(o=>({importId:null,productDetailId:parseInt(o.productId),quantity:o.quantity||1,importPrice:o.importPrice,exportPrice:o.exportPrice}));fetch("http://localhost:8080/api/importproduct/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(o=>{o.ok&&fetch("http://localhost:8080/api/importproduct/importdetailandupdateproductdetail",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(l=>l.json()).then(l=>{console.log("Update success:",l),this.toggleAddModal()}).catch(l=>console.error("Error updating detail:",l))}).catch(o=>console.error("Error adding import:",o))});this.state={showAddModal:!1,showViewModal:!1,selectedImport:null,products:[],formData:{supplierId:"",employeeId:"",employeeName:"",importPrice:0,exportPrice:0,quantity:1,selectedProducts:[]}}}componentDidMount(){this.fetchEmployees(),this.fetchProducts()}render(){const{showAddModal:t,showViewModal:n,selectedImport:r,products:o}=this.state,l=[{id:1,importDate:"2024-01-01",supplierId:"SUP001",employeeId:"EMP001",totalAmount:1e6}];return e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs(T,{children:[e.jsxs(q,{children:["Import Product Information",e.jsx(h,{color:"primary",className:"float-end",onClick:this.toggleAddModal,children:"Thêm phiếu nhập"})]}),e.jsx(A,{children:e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(m,{children:[e.jsx(a,{children:"Mã phiếu nhập"}),e.jsx(a,{children:"Thời gian"}),e.jsx(a,{children:"Mã nhà cung cấp"}),e.jsx(a,{children:"Nhân viên"}),e.jsx(a,{children:"Tổng tiền"}),e.jsx(a,{children:"Hành động"})]})}),e.jsx(C,{children:l.map((s,u)=>e.jsxs(m,{children:[e.jsx(i,{children:s.id}),e.jsx(i,{children:s.importDate}),e.jsx(i,{children:s.supplierId}),e.jsx(i,{children:s.employeeId}),e.jsx(i,{children:s.totalAmount}),e.jsxs(i,{children:[e.jsx(h,{color:"info",onClick:()=>this.toggleViewModal(s),children:"Xem phiếu"}),e.jsx(h,{color:"danger",className:"ms-2",children:"Hủy phiếu"})]})]},u))})]})})]})}),e.jsxs(y,{visible:t,onClose:this.toggleAddModal,size:"lg",children:[e.jsx(D,{children:e.jsx(P,{children:"Thêm phiếu nhập"})}),e.jsx(I,{children:e.jsxs(F,{onSubmit:this.handleFormSubmit,children:[e.jsxs(x,{className:"mb-3",label:"Nhà cung cấp",value:this.state.formData.supplierId,onChange:s=>this.setState({formData:{...this.state.formData,supplierId:s.target.value}}),children:[e.jsx("option",{value:"",children:"Chọn nhà cung cấp"}),e.jsx("option",{value:"1",children:"Nhà cung cấp 1"})]}),e.jsx(x,{className:"mb-3",label:"Nhân viên",value:this.state.formData.employeeId||"",disabled:!0,children:e.jsx("option",{value:this.state.formData.employeeId||"",children:this.state.formData.employeeName||"No Employee Found"})}),e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-3",children:e.jsxs(x,{name:"product",children:[e.jsx("option",{value:"",children:"Chọn sản phẩm"}),o&&o.map(s=>e.jsx("option",{value:s.product.id,children:`${s.product.name} - Màu: ${s.details[0].color} - Size: ${s.details[0].size}`},s.product.id))]})}),e.jsx("div",{className:"col-3",children:e.jsx(j,{type:"number",label:"Giá nhập",value:this.state.formData.importPrice,onChange:s=>this.setState({formData:{...this.state.formData,importPrice:parseFloat(s.target.value)}})})}),e.jsx("div",{className:"col-3",children:e.jsx(j,{type:"number",label:"Giá xuất",value:this.state.formData.exportPrice,onChange:s=>this.setState({formData:{...this.state.formData,exportPrice:parseFloat(s.target.value)}})})}),e.jsx("div",{className:"col-3",children:e.jsx(j,{type:"number",label:"Số lượng",value:this.state.formData.quantity,onChange:s=>this.setState({formData:{...this.state.formData,quantity:parseInt(s.target.value)||1}})})})]}),e.jsx("div",{className:"mb-3 d-flex",children:e.jsx(h,{color:"primary",onClick:this.handleAddProduct,children:"Thêm"})}),e.jsx("h6",{children:"Danh sách sản phẩm đã chọn"}),e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(m,{children:[e.jsx(a,{children:"Mã SP"}),e.jsx(a,{children:"Tên SP"}),e.jsx(a,{children:"Giá nhập"}),e.jsx(a,{children:"Giá xuất"}),e.jsx(a,{children:"Số lượng"})]})}),e.jsx(C,{children:this.state.formData.selectedProducts.map((s,u)=>e.jsxs(m,{children:[e.jsx(i,{children:s.productId}),e.jsx(i,{children:s.productName}),e.jsx(i,{children:s.importPrice}),e.jsx(i,{children:s.exportPrice}),e.jsx(i,{children:s.quantity||1})]},u))})]}),e.jsxs(b,{children:[e.jsx(h,{color:"secondary",onClick:this.toggleAddModal,children:"Đóng"}),e.jsx(h,{color:"primary",type:"submit",children:"Lưu"})]})]})})]}),e.jsxs(y,{visible:n,onClose:()=>this.toggleViewModal(),children:[e.jsx(D,{children:e.jsx(P,{children:"Chi tiết phiếu nhập"})}),e.jsx(I,{children:r&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Mã phiếu: ",r.id]}),e.jsxs("p",{children:["Thời gian: ",r.importDate]}),e.jsxs("p",{children:["Nhà cung cấp: ",r.supplierId]}),e.jsxs("p",{children:["Nhân viên: ",r.employeeId]}),e.jsxs("p",{children:["Tổng tiền: ",r.totalAmount]})]})}),e.jsx(b,{children:e.jsx(h,{color:"secondary",onClick:()=>this.toggleViewModal(),children:"Đóng"})})]})]})}}export{Q as default};
