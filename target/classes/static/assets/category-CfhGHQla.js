var x=Object.defineProperty;var j=(l,s,t)=>s in l?x(l,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[s]=t;var n=(l,s,t)=>j(l,typeof s!="symbol"?s+"":s,t);import{R as f,j as e}from"./index-DFNBekDS.js";import{C as y,a as u}from"./CRow-JlIPi5Ky.js";import{C as P,a as T}from"./CCardBody-DbBmmM1v.js";import{C as M}from"./CCardHeader-B7KP0wng.js";import{a as h}from"./index.esm-B8RAtgvt.js";import{C as L,a as b,b as m,c as d,d as k,e as C}from"./CTable-f6QzvBmY.js";import{P as w}from"./Pagination-BI4lYjrA.js";import{C as S,a as I,b as R,c as v,d as U}from"./CModalTitle-BhtgCe7w.js";import{C as D}from"./CForm-k4fer3Cx.js";import{C as N}from"./CFormLabel-2Eu_0M6q.js";import{C as A}from"./CFormInput-DmwITFIQ.js";import"./DefaultLayout-BmN3feMo.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-C7oJfgOg.js";import"./CFormControlValidation-DyyE0W6Z.js";class Y extends f.Component{constructor(t){super(t);n(this,"handlePageChange",(t,o)=>{this.setState({currentPage:o}),this.fetchCategories(o)});n(this,"toggleModal",(t=null)=>{this.setState(o=>({showModal:!o.showModal,editCategory:t,newCategory:t||{id:"",name:""}}))});n(this,"handleInputChange",t=>{const{name:o,value:a}=t.target;this.setState(r=>({newCategory:{...r.newCategory,[o]:a}}))});n(this,"handleSave",()=>{const{newCategory:t,editCategory:o}=this.state,a={id:t.id,name:t.name};if(t.name===""){alert("Vui lòng nhập tên thể loại");return}const r="http://localhost:8080/api/categories";o?fetch(`${r}/update/${o.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(i=>{i.ok?(alert("Sửa thể loại thành công"),this.toggleModal(),this.fetchCategories(this.state.currentPage)):(alert("Có lỗi xảy ra khi sửa thể loại"),console.error("Lỗi sửa thể loại:",i))}).catch(i=>{alert("Có lỗi xảy ra khi sửa thể loại"),console.error("Lỗi sửa thể loại:",i)}):fetch(`${r}/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(i=>{i.ok?(alert("Thêm thể loại thành công"),this.toggleModal(),this.fetchCategories(this.state.currentPage)):(alert("Có lỗi xảy ra khi thêm thể loại"),console.error("Lỗi thêm thể loại:",i))}).catch(i=>{alert("Có lỗi xảy ra khi thêm thể loại"),console.error("Lỗi thêm thể loại:",i)})});n(this,"handleDelete",t=>{fetch(`http://localhost:8080/api/categories/updateStatus/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"}}).then(a=>{a.ok?(alert("Xóa thể loại thành công"),this.fetchCategories(this.state.currentPage)):(alert("Có lỗi xảy ra khi xóa thể loại"),console.error("Lỗi xóa thể loại:",a))})});this.state={categories:[],currentPage:1,pageLimit:0,perPage:5,showModal:!1,editCategory:null,newCategory:{id:"",name:""}}}componentDidMount(){this.fetchCategories(1)}fetchCategories(t){fetch("http://localhost:8080/api/categories/getall").then(a=>a.json()).then(a=>{const r=Math.ceil(a.length/this.state.perPage);this.setState({categories:a,pageLimit:r})}).catch(a=>{console.error("Lỗi fetch categories:",a)})}render(){const{categories:t,currentPage:o,pageLimit:a,showModal:r,newCategory:i,editCategory:g}=this.state;return e.jsxs(y,{children:[e.jsx(u,{children:e.jsxs(P,{children:[e.jsxs(M,{children:["Category Information",e.jsx(h,{color:"primary",className:"float-end",onClick:()=>this.toggleModal(),children:"Thêm thể loại"})]}),e.jsxs(T,{children:[e.jsxs(L,{children:[e.jsx(b,{children:e.jsxs(m,{children:[e.jsx(d,{children:"ID"}),e.jsx(d,{children:"Tên thể loại"}),e.jsx(d,{children:"Hành động"})]})}),e.jsx(k,{children:t.map((c,p)=>e.jsxs(m,{children:[e.jsx(C,{children:c.id}),e.jsx(C,{children:c.name}),e.jsxs(C,{children:[e.jsx(h,{color:"warning",onClick:()=>this.toggleModal(c),children:"Sửa"}),e.jsx(h,{color:"danger",onClick:()=>this.handleDelete(c.id),children:"Xóa"})]})]},p))})]}),e.jsx(w,{count:a,page:o,onChange:this.handlePageChange,variant:"outlined",shape:"rounded"})]})]})}),e.jsxs(S,{visible:r,onClose:()=>this.toggleModal(),children:[e.jsx(I,{children:e.jsx(R,{children:g?"Chỉnh sửa thể loại":"Thêm thể loại"})}),e.jsx(v,{children:e.jsx(D,{children:e.jsxs("div",{className:"mb-3",children:[e.jsx(N,{htmlFor:"categoryName",children:"Tên thể loại"}),e.jsx(A,{type:"text",id:"categoryName",name:"name",value:i.name,onChange:this.handleInputChange})]})})}),e.jsxs(U,{children:[e.jsx(h,{color:"secondary",onClick:()=>this.toggleModal(),children:"Đóng"}),e.jsx(h,{color:"primary",onClick:this.handleSave,children:g?"Cập nhật":"Lưu"})]})]})]})}}export{Y as default};
