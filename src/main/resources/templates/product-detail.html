<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tech2etc Ecommerce Tutorial</title>
    <link rel="stylesheet" href="./style.css" />
    <link rel="stylesheet" th:href="@{/css/style1.css}">
    <script src="https://kit.fontawesome.com/bea9b25826.js" crossorigin="anonymous"></script>

    <script>
        //Hàm cập nhật giá sản phẩm khi chọn size
        function updatePrice() {
            var select = document.getElementById("product-options");
            var price = select.options[select.selectedIndex].value;
            document.getElementById("product-price").innerText = "$" + price;
        }
    </script>

    <script>
        //Ham lay tham so tu url product_id
        function getParameterByName(name) {
            var url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        //Hàm thêm sản phẩm vào giỏ hàng
        function addToCart() {
            var select = document.getElementById("product-options");
            var selectedOption = select.options[select.selectedIndex];
            var product = {
                id: selectedOption.getAttribute("data-id"),
                productId:  getParameterByName('product_id'),
                name: document.querySelector(".single-pro-details h4").innerText,
                price: selectedOption.value,
                size: selectedOption.text.split(' - ')[0].split(': ')[1],
                color: selectedOption.text.split(' - ')[1].split(': ')[1],
                quantity: parseInt(document.querySelector(".single-pro-details input[type='number']").value),
                img: document.querySelector(".single-pro-image img").src
            };

            var cart = JSON.parse(localStorage.getItem("cart")) || [];
            var existingProductIndex = cart.findIndex(item =>
                item.id === product.id &&
                item.productId === product.productId
            );

            if (existingProductIndex !== -1) {
                cart[existingProductIndex].quantity += product.quantity;
            } else {
                cart.push(product);
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartDisplay();
        }


        //Hàm cập nhật giỏ hàng
        function updateCartDisplay() {
            var cart = JSON.parse(localStorage.getItem("cart")) || [];
            var cartItemsContainer = document.querySelector(".mini-cart .products");
            cartItemsContainer.innerHTML = "";

            cart.forEach(function(item, index) {
                var cartItem = document.createElement("li");
                cartItem.classList.add("item");
                cartItem.innerHTML = `
            <div class="thumbnail object-cover">
                <a href="#"><img src="${item.img}" alt=""></a>
            </div>
            <div class="item-content">
                <p><a href="#" style="font-size: 14px">${item.name}</a></p>
                <span class="price">
                    <span>$${item.price} - ${item.size} - ${item.color}</span>
                    <button class="fly-item" onclick="removeFromCart(${index})"><span>X</span></button>
                </span>
                <div class="qty-control flexitem">
                    <button class="minus" onclick="updateQuantity(${index}, -1)">-</button>
                    <input type="text" value="${item.quantity}" min="1">
                    <button class="plus" onclick="updateQuantity(${index}, 1)">+</button>
                </div>
            </div>
            <a href="" class="item-remove" onclick="removeFromCart(${index})"><i class="ri-close-line"></i></a>
        `;
                cartItemsContainer.appendChild(cartItem);
            });
        }


        //Hàm xóa sản phẩm khỏi giỏ hàng
        function removeFromCart(index) {
            var cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart.splice(index, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartDisplay();
        }

        //Hàm cập nhật số lượng sản phẩm trong giỏ hàng
        function updateQuantity(index, change) {
            var cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart[index].quantity = Math.max(1, parseInt(cart[index].quantity) + change);
            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartDisplay();
        }

        document.addEventListener("DOMContentLoaded", updateCartDisplay);
    </script>


    <script>

        //Hàm tính tổng số lượng và tổng giá trị sản phẩm trong giỏ hàng
        function updateCartDisplay() {
            var cart = JSON.parse(localStorage.getItem("cart")) || [];
            var cartItemsContainer = document.querySelector(".mini-cart .products");
            cartItemsContainer.innerHTML = "";

            var totalQuantity = 0;
            var totalPrice = 0;

            cart.forEach(function(item, index) {
                totalQuantity += item.quantity;
                totalPrice += item.price * item.quantity;

                var cartItem = document.createElement("li");
                cartItem.classList.add("item");
                cartItem.innerHTML = `
            <div class="thumbnail object-cover">
                <a href="#"><img src="${item.img}" alt=""></a>
            </div>
            <div class="item-content">
                <p><a href="#" style="font-size: 14px">${item.name}</a></p>
                <span class="price">
                    <span>$${item.price} - ${item.size} - ${item.color}</span>
                    <button class="fly-item" onclick="removeFromCart(${index})"><span>X</span></button>
                </span>
                <div class="qty-control flexitem">
                    <button class="minus" onclick="updateQuantity(${index}, -1)">-</button>
                    <input type="text" value="${item.quantity}" min="1">
                    <button class="plus" onclick="updateQuantity(${index}, 1)">+</button>
                </div>
            </div>
            <a href="" class="item-remove" onclick="removeFromCart(${index})"><i class="ri-close-line"></i></a>
        `;
                cartItemsContainer.appendChild(cartItem);
            });

            document.querySelector(".cart-head").innerText = `${totalQuantity} items in cart`;
            document.querySelector(".fly-item .item-number").innerText = totalQuantity;
            document.querySelector(".subtotal p strong").innerText = `$${totalPrice.toFixed(2)}`;
        }

        document.addEventListener("DOMContentLoaded", updateCartDisplay);
    </script>

</head>
<body>
<section id="header">
    <a href="#">
        <img src="./img/logo.png" class="logo" alt="logo" />
    </a>

    <div>
        <ul id="navbar">
            <li><a  th:href="@{/index}">Home</a></li>
            <li><a  th:href="@{/shop}">Shop</a></li>
            <li><a  th:href="@{/blog}">Blog</a></li>
            <li><a th:href="@{/about}">About</a></li>
            <li><a th:href="@{/contact}">Contact</a></li>
            <li id="lg-bag">
                <a th:href="@{/cart}"><i class="fa-solid fa-bag-shopping"></i></a>
            </li>
            <li class="iscart">
                <a href="#">
                    <div class="icon-large" style="display: flex">
                        <div class="fly-item"><span class="item-number" style="
    position: absolute;
        top: -22px;
    left: 28px;
    color: green;
">5</span></div>
                        <i class="fa-solid fa-shopping-cart"></i>
                    </div>

                </a>
                <div class="mini-cart">
                    <div class="content">
                        <div class="cart-head">
                            5 items in cart
                        </div>
                        <div class="cart-body">
                            <ul class="products mini">

                                <li class="item">
                                    <div class="thumbnail object-cover">
                                        <a href="#"><img th:src="@{/img/products/n1.jpg}" alt=""></a>
                                    </div>
                                    <div class="item-content">
                                        <p><a href="#" style="font-size: 14px">Dimmable Ceiling Light Modern</a></p>
                                        <span class="price">
                                                            <span>$279.99 - XL - Xanh</span>
                                                            <button class="fly-item"><span>X</span></button>

                                                        </span>
                                        <div class="qty-control flexitem">
                                            <button class="minus">-</button>
                                            <input type="text" value="2" min="1">
                                            <button class="plus">+</button>
                                        </div>
                                    </div>
                                    <a href="" class="item-remove"><i class="ri-close-line"></i></a>
                                </li>

                                <li class="item">
                                    <div class="thumbnail object-cover">
                                        <a href="#"><img th:src="@{/img/products/n1.jpg}" alt=""></a>
                                    </div>
                                    <div class="item-content">
                                        <p><a href="#" style="font-size: 14px">Modern Storage Cabinet with Door & 3
                                            Drawers</a></p>
                                        <span class="price">
                                                            <span>$129.99 - L - Vàng</span>
                                                            <button class="fly-item"><span>X</span></button>
                                                        </span>
                                        <div class="qty-control flexitem">
                                            <button class="minus">-</button>
                                            <input type="text" value="2" min="1">
                                            <button class="plus">+</button>
                                        </div>
                                    </div>
                                    <a href="" class="item-remove"><i class="ri-close-line"></i></a>
                                </li>
                                <li class="item">
                                    <div class="thumbnail object-cover">
                                        <a href="#"><img th:src="@{/img/products/n1.jpg}" alt=""></a>
                                    </div>
                                    <div class="item-content">
                                        <p><a href="#" style="font-size: 14px">Vonanda Velvet Sofa Couch</a></p>
                                        <span class="price">
                                                            <span>$352.99 - M - Trắng</span>
                                                            <button class="fly-item"><span>X</span></button>
                                                        </span>
                                        <div class="qty-control flexitem">
                                            <button class="minus">-</button>
                                            <input type="text" value="2" min="1">
                                            <button class="plus">+</button>
                                        </div>
                                    </div>
                                    <a href="" class="item-remove"><i class="ri-close-line"></i></a>
                                </li>
                            </ul>
                        </div>
                        <div class="cart-footer">
                            <div class="subtotal">
                                <p>Subtotal</p>
                                <p><strong>$1,622.95</strong></p>
                            </div>
                            <div class="actions">
                                <a th:href="@{/cart}" class="primary-button">Checkout</a>

                            </div>
                        </div>
                    </div>
                </div>
            </li>

            <a href="#" id="close"><i class="fa-solid fa-xmark"></i></a>
        </ul>
    </div>

    <div id="mobile">
        <a href="cart.html"><i class="fa-solid fa-bag-shopping"></i></a>
        <i id="bar" class="fas fa-outdent"></i>
    </div>
</section>

<section id="prodetails" class="section-p1">

    <div class="single-pro-image">
        <img th:src="@{${product.img}}" width="100%" id="MainImg" alt="" />

        <div class="small-img-group">
            <div class="small-img-col">
                <img src="./img/products/f1.jpg" width="100%" class="small-img" alt="" />
            </div>
            <div class="small-img-col">
                <img src="./img/products/f2.jpg" width="100%" class="small-img" alt="" />
            </div>
            <div class="small-img-col">
                <img src="./img/products/f3.jpg" width="100%" class="small-img" alt="" />
            </div>
            <div class="small-img-col">
                <img src="./img/products/f4.jpg" width="100%" class="small-img" alt="" />
            </div>
        </div>
    </div>

    <div class="single-pro-details" data-product-id="${product.id}">
        <h6>Home / T-Shirts</h6>
        <h4 th:text="${product.name}"></h4>
        <h2 id="product-price" th:if="${productDetails != null and !productDetails.isEmpty()}"
            th:text="'$' + ${productDetails[0].price}"></h2>
        <select id="product-options" onchange="updatePrice()">
            <option th:each="producDetail : ${productDetails}" th:text="'Size: ' + ${producDetail.size} + ' - Màu: ' + ${producDetail.color}" th:value="${producDetail.price}" th:attr="data-id=${producDetail.id}" ></option>
        </select>
        <input type="number" value="1">
        <button class="normal" onclick="addToCart()">Add To Cart</button>
        <h4>Product Details</h4>
        <span th:text="${product.description}"></span>
    </div>

</section>

<section id="product1" class="section-p1">
    <h2>Featured Products</h2>
    <p>Summer Collection New Morden Design</p>
    <div class="pro-container">
        <div class="pro">
            <img src="./img/products/n1.jpg" alt="">
            <div class="des">
                <span>adidas</span>
                <h5>Cartoon Astronaut T-Shirts</h5>
                <div class="star">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <h4>$78</h4>
            </div>
            <a href="#"><i class="fa-solid fa-bag-shopping cart"></i></a>
        </div>
        <div class="pro">
            <img src="./img/products/n2.jpg" alt="">
            <div class="des">
                <span>adidas</span>
                <h5>Cartoon Astronaut T-Shirts</h5>
                <div class="star">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <h4>$78</h4>
            </div>
            <a href="#"><i class="fa-solid fa-bag-shopping cart"></i></a>
        </div>
        <div class="pro">
            <img src="./img/products/n3.jpg" alt="">
            <div class="des">
                <span>adidas</span>
                <h5>Cartoon Astronaut T-Shirts</h5>
                <div class="star">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <h4>$78</h4>
            </div>
            <a href="#"><i class="fa-solid fa-bag-shopping cart"></i></a>
        </div>
        <div class="pro">
            <img src="./img/products/n4.jpg" alt="">
            <div class="des">
                <span>adidas</span>
                <h5>Cartoon Astronaut T-Shirts</h5>
                <div class="star">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                </div>
                <h4>$78</h4>
            </div>
            <a href="#"><i class="fa-solid fa-bag-shopping cart"></i></a>
        </div>
<!--        if logged in then show div-->
        <div sec:authorize="isAuthenticated()">
            <p>Welcome back, user!</p>
        </div>
    </div>
</section>

<section id="newsletter" class="section-p1 section-m1">
    <div class="newstext">
        <h4>Sign Up For Newsletters</h4>
        <p>Get E-mail updates about our latest shop and <span>special offers.</span></p>
    </div>
    <div class="form">
        <input type="text" placeholder="Your email address" />
        <button class="normal">Sign Up</button>
    </div>
</section>

<footer class="section-p1">
    <div class="col">
        <img class="logo" src="./img/logo.png" alt="" />
        <h4>Contact</h4>
        <p><strong>Address:</strong> 562 Welligton Road, Street 32, San Francisco</p>
        <p><strong>Phone:</strong> +01 2222 365 /(+91) 01 2345 6789</p>
        <p><strong>Hours:</strong> 10:00 - 18.00, Mon - Sat</p>
        <div class="follow">
            <h4>Follow</h4>
            <div class="icon">
                <i class="fab fa-facebook-f"></i>
                <i class="fab fa-twitter"></i>
                <i class="fab fa-instagram"></i>
                <i class="fab fa-pinterest-p"></i>
                <i class="fab fa-youtube"></i>
            </div>
        </div>
    </div>

    <div class="col">
        <h4>About</h4>
        <a href="#">About us</a>
        <a href="#">Delivery information</a>
        <a href="#">Privacy Policy</a>
        <a href="#">Terms & Conditions</a>
        <a href="#">Contact Us</a>
    </div>

    <div class="col">
        <h4>My Account</h4>
        <a href="#">Sign In</a>
        <a href="#">View Cart</a>
        <a href="#">My Wishlist</a>
        <a href="#">Track My Order</a>
        <a href="#">Help</a>
    </div>

    <div class="col install">
        <h4>Install App</h4>
        <p>From App Store or Google Play</p>
        <div class="row">
            <img src="./img/pay/app.jpg" alt="" />
            <img src="./img/pay/play.jpg" alt="" />
        </div>
        <p>Secured Payment Gateways</p>
        <img src="./img/pay/pay.png" alt="" />
    </div>

    <div class="copyright">
        <p>2021, Tech2 etc - HTML CSS Ecommerce Template</p>
    </div>
</footer>

<script>
    var MainImg = document.getElementById('MainImg')
    var smallimg = document.getElementsByClassName('small-img')
    smallimg[0].onclick = function () {
        MainImg.src = smallimg[0].src
    }
    smallimg[1].onclick = function () {
        MainImg.src = smallimg[1].src
    }
    smallimg[2].onclick = function () {
        MainImg.src = smallimg[2].src
    }
    smallimg[3].onclick = function () {
        MainImg.src = smallimg[3].src
    }
</script>

<script src="./script.js"></script>
</body>
</html>
